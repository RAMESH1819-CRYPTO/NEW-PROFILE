<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIZUKA!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .view-section { display: none; }
        .view-section.active { display: block; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">

    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i data-lucide="message-circle" class="text-indigo-600 w-8 h-8"></i>
                    <h1 class="text-3xl font-bold text-gray-800">SIZUKA AI</h1>
                </div>
                <button id="logoutBtn" class="hidden flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                    Logout
                </button>
            </div>
        </div>

        <div id="view-home" class="view-section active">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-lg p-8 hover:shadow-xl transition">
                    <i data-lucide="user" class="text-indigo-600 w-12 h-12 mb-4"></i>
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">User Portal</h2>
                    <p class="text-gray-600 mb-6">Sign up or login to chat</p>
                    <div class="space-y-3">
                        <button onclick="switchView('view-signup')" class="w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-semibold">Sign Up</button>
                        <button onclick="switchView('view-user-login')" class="w-full py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition font-semibold">Login</button>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-8 hover:shadow-xl transition">
                    <i data-lucide="lock" class="text-purple-600 w-12 h-12 mb-4"></i>
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Admin Portal</h2>
                    <p class="text-gray-600 mb-6">Manage AI commands</p>
                    <button onclick="switchView('view-admin-login')" class="w-full py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold">Admin Login</button>
                </div>
            </div>
        </div>

        <div id="view-signup" class="view-section">
            <div class="bg-white rounded-lg shadow-lg p-8 max-w-md mx-auto">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Create Account</h2>
                <form id="signupForm" class="space-y-4">
                    <input type="text" name="username" placeholder="Username" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    <input type="email" name="email" placeholder="Email" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    <input type="password" name="password" placeholder="Password" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-semibold">Sign Up</button>
                    <button type="button" onclick="switchView('view-home')" class="w-full py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-semibold">Back</button>
                </form>
            </div>
        </div>

        <div id="view-user-login" class="view-section">
            <div class="bg-white rounded-lg shadow-lg p-8 max-w-md mx-auto">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">User Login</h2>
                <form id="userLoginForm" class="space-y-4">
                    <input type="text" name="username" placeholder="Username" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    <input type="password" name="password" placeholder="Password" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    
                    <div class="flex items-center">
                        <input type="checkbox" name="remember" id="userRemember" class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        <label for="userRemember" class="ml-2 block text-sm text-gray-900">Remember me</label>
                    </div>

                    <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-semibold">Login</button>
                    <button type="button" onclick="switchView('view-home')" class="w-full py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-semibold">Back</button>
                </form>
            </div>
        </div>

        <div id="view-admin-login" class="view-section">
            <div class="bg-white rounded-lg shadow-lg p-8 max-w-md mx-auto">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Admin Login</h2>
                <form id="adminLoginForm" class="space-y-4">
                    <input type="text" name="username" placeholder="Username" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500" required>
                    <input type="password" name="password" placeholder="Password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500" required>
                    
                    <div class="flex items-center">
                        <input type="checkbox" name="remember" id="adminRemember" class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                        <label for="adminRemember" class="ml-2 block text-sm text-gray-900">Remember me</label>
                    </div>

                    <button type="submit" class="w-full py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold">Login</button>
                    <button type="button" onclick="switchView('view-home')" class="w-full py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-semibold">Back</button>
                </form>
            </div>
        </div>

        <div id="view-admin-panel" class="view-section">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Admin Panel</h2>
                    <button onclick="resetToDefaults()" class="text-sm text-red-500 underline">Reset All Data</button>
                </div>
                
                <div class="mb-8 p-6 bg-purple-50 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Add New Command</h3>
                    <form id="addCommandForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 mb-2 font-semibold">Command</label>
                            <input type="text" name="command" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500" placeholder="e.g., what is your name" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2 font-semibold">Response</label>
                            <textarea name="response" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500" placeholder="e.g., Ramesh" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="flex items-center gap-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold">
                            <i data-lucide="plus" class="w-5 h-5"></i> Add Command
                        </button>
                    </form>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Existing Commands</h3>
                    <div id="commandsList" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <div id="view-chat" class="view-section">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Chat with SIZUKA</h2>
                <p id="chatWelcomeMsg" class="text-gray-600 mb-6">Welcome!</p>
                <div id="chatContainer" class="h-96 overflow-y-auto mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200"></div>
                <form id="chatForm" class="flex gap-2">
                    <input type="text" id="chatInput" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500" placeholder="Type a command..." required>
                    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-semibold flex items-center gap-2">
                        <i data-lucide="send" class="w-5 h-5"></i> Send
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- STORAGE KEYS ---
        const STORAGE_KEY_USERS = 'ai_app_users';
        const STORAGE_KEY_COMMANDS = 'ai_app_commands';
        const STORAGE_KEY_SESSION_USER = 'ai_app_session_user';
        const STORAGE_KEY_SESSION_ADMIN = 'ai_app_session_admin';

        // --- DATA INIT ---
        const DEFAULT_COMMANDS = [
            { command: 'hello', response: 'Hello! How can I help you today?' },
            { command: 'how are you', response: 'I am doing great! Thanks for asking.' },
            { command: 'bye', response: 'Goodbye! Have a great day!' }
        ];

        let users = [];
        let commands = [];
        let currentUser = null;
        let isAdmin = false;
        let chatHistory = [];

        // --- STORAGE FUNCTIONS ---
        function loadData() {
            const storedUsers = localStorage.getItem(STORAGE_KEY_USERS);
            const storedCommands = localStorage.getItem(STORAGE_KEY_COMMANDS);
            
            users = storedUsers ? JSON.parse(storedUsers) : [];
            commands = storedCommands ? JSON.parse(storedCommands) : [...DEFAULT_COMMANDS];
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY_USERS, JSON.stringify(users));
            localStorage.setItem(STORAGE_KEY_COMMANDS, JSON.stringify(commands));
        }

        function resetToDefaults() {
            if(confirm("This will delete all created users and custom commands. Are you sure?")) {
                localStorage.clear(); // Clears everything including sessions
                location.reload();
            }
        }

        // --- HELPERS ---
        function normalizeText(text) {
            return text.toLowerCase().trim().replace(/\?/g, '').replace(/\s+/g, ' ');
        }

        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            const logoutBtn = document.getElementById('logoutBtn');
            if (currentUser || isAdmin) {
                logoutBtn.classList.remove('hidden');
            } else {
                logoutBtn.classList.add('hidden');
            }
            lucide.createIcons();
        }

        // --- CHECK REMEMBER ME ON LOAD ---
        function checkSession() {
            // Check Admin Session first
            const adminSession = localStorage.getItem(STORAGE_KEY_SESSION_ADMIN);
            if (adminSession === 'true') {
                isAdmin = true;
                currentUser = null;
                renderCommandList();
                switchView('view-admin-panel');
                return;
            }

            // Check User Session
            const userSession = localStorage.getItem(STORAGE_KEY_SESSION_USER);
            if (userSession) {
                const foundUser = users.find(u => u.username === userSession);
                if (foundUser) {
                    currentUser = foundUser;
                    isAdmin = false;
                    document.getElementById('chatWelcomeMsg').textContent = `Welcome back, ${foundUser.username}!`;
                    chatHistory = [{ type: 'ai', message: 'Welcome back! Type a command.' }];
                    renderChat();
                    switchView('view-chat');
                    return;
                }
            }
            // If no session, stay on home
        }

        // --- AUTH LOGIC ---
        
        // Signup
        document.getElementById('signupForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            if (users.find(u => u.username === data.username)) {
                alert('Username already exists!');
                return;
            }
            users.push(data);
            saveData();
            alert('Signup successful! Please login.');
            e.target.reset();
            switchView('view-user-login');
        });

        // User Login
        document.getElementById('userLoginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            const rememberMe = formData.get('remember') === 'on'; // Checkbox value

            const user = users.find(u => u.username === data.username && u.password === data.password);
            
            if (user) {
                currentUser = user;
                isAdmin = false;
                
                // Handle Remember Me
                if (rememberMe) {
                    localStorage.setItem(STORAGE_KEY_SESSION_USER, user.username);
                }

                document.getElementById('chatWelcomeMsg').textContent = `Welcome, ${user.username}!`;
                chatHistory = [{ type: 'ai', message: 'Welcome! Type a command to get started.' }];
                renderChat();
                switchView('view-chat');
                e.target.reset();
            } else {
                alert('Invalid credentials!');
            }
        });

        // Admin Login
        document.getElementById('adminLoginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            const rememberMe = formData.get('remember') === 'on'; // Checkbox value

            if (data.username === 'ramesh' && data.password === 'ramvaishu@2218') {
                isAdmin = true;
                currentUser = null;

                // Handle Remember Me
                if (rememberMe) {
                    localStorage.setItem(STORAGE_KEY_SESSION_ADMIN, 'true');
                }

                renderCommandList();
                switchView('view-admin-panel');
                e.target.reset();
            } else {
                alert('Invalid admin credentials!');
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            currentUser = null;
            isAdmin = false;
            chatHistory = [];
            // Clear Remember Me Sessions
            localStorage.removeItem(STORAGE_KEY_SESSION_USER);
            localStorage.removeItem(STORAGE_KEY_SESSION_ADMIN);
            switchView('view-home');
        });

        // --- ADMIN PANEL LOGIC ---
        function renderCommandList() {
            const container = document.getElementById('commandsList');
            container.innerHTML = '';
            commands.forEach((cmd, index) => {
                const div = document.createElement('div');
                div.className = 'p-4 bg-gray-50 rounded-lg border border-gray-200';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="font-semibold text-indigo-600 mb-1">Command: ${cmd.command}</p>
                            <p class="text-gray-700">Response: ${cmd.response}</p>
                        </div>
                        <button onclick="deleteCommand(${index})" class="ml-4 p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
            lucide.createIcons();
        }

        document.getElementById('addCommandForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            commands.push({ 
                command: data.command.trim(), 
                response: data.response.trim() 
            });
            saveData();
            alert('Command added successfully and saved!');
            e.target.reset();
            renderCommandList();
        });

        window.deleteCommand = (index) => {
            if(confirm('Delete this command?')) {
                commands.splice(index, 1);
                saveData();
                renderCommandList();
            }
        };

        // --- CHAT LOGIC ---
        function renderChat() {
            const container = document.getElementById('chatContainer');
            container.innerHTML = '';
            chatHistory.forEach(chat => {
                const wrapper = document.createElement('div');
                wrapper.className = `mb-3 ${chat.type === 'user' ? 'text-right' : 'text-left'}`;
                const bubble = document.createElement('div');
                bubble.className = `inline-block px-4 py-2 rounded-lg ${chat.type === 'user' ? 'bg-indigo-600 text-white' : 'bg-gray-300 text-gray-800'}`;
                bubble.textContent = chat.message;
                wrapper.appendChild(bubble);
                container.appendChild(wrapper);
            });
            container.scrollTop = container.scrollHeight;
        }

        document.getElementById('chatForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const inputEl = document.getElementById('chatInput');
            const userText = inputEl.value;
            if (!userText.trim()) return;

            chatHistory.push({ type: 'user', message: userText });

            const matchedCommand = commands.find(cmd => 
                normalizeText(cmd.command) === normalizeText(userText)
            );

            const aiResponse = matchedCommand 
                ? matchedCommand.response 
                : "I don't understand that command. Please try another one.";

            setTimeout(() => {
                chatHistory.push({ type: 'ai', message: aiResponse });
                renderChat();
            }, 300);

            inputEl.value = '';
            renderChat();
        });

        // --- APP STARTUP ---
        loadData();
        checkSession(); // Checks if user checked 'Remember Me' previously
        lucide.createIcons();
    </script>
</body>
</html>

